[{"name": "app.py", "content": "import shinyswatch\nfrom shiny import App, ui, render, reactive\nfrom faicons import icon_svg\nimport pandas as pd\nimport data_utils as du\nfrom pathlib import Path\nfrom input_data import default_checkbox, default_select, questions\n\n### ----- Front end: User interface ----- ###\n\napp_ui = ui.page_fluid(\n    # TODO: select theme? shinyswatch.theme.sketchy(),\n    shinyswatch.theme_picker_ui(),\n    ui.panel_title(\"Workflow Explorer\"),\n    ui.layout_sidebar(\n        # Question panel\n        ui.panel_sidebar(\n            [\n                du.input_question(id, q.get(\"label\"), q.get(\"choices\"), q.get(\"type\"))\n                for id, q in questions.items()\n            ],\n            ui.input_action_button(\n                \"reset\",\n                \"Clear choices\",\n                width=\"30%\",\n            ),\n        ),\n        # Answer table\n        ui.panel_main(ui.dataframe.output_data_frame(\"filter\")),\n    ),\n    # Styling\n    ui.include_css(Path(__file__).parent / \"static/styles/main.css\"),\n    ui.panel_absolute(\n        ui.div(\n            ui.tags.a(\n                icon_svg(\"github\", width=\"45px\", height=\"48px\"),\n                href=\"https://github.com/SDSC-ORD/workflow-explorer\",\n                target=\"_blank\",\n            ),\n        ),\n        bottom=\"0%\",\n        right=\"1%\",\n    ),\n)\n\n### ---------------------------- ###\n\n### ----- Back end: server ----- ###\n\n\ndef server(input, output, session):\n    wf_tab = pd.read_csv(Path(__file__).parent / \"workflowTable.tsv\", sep=\"\\t\")\n\n    # TODO: remove to use a fixed theme\n    shinyswatch.theme_picker_server()\n\n    # Reset event\n    @reactive.Effect\n    @reactive.event(input.reset)\n    def _():\n        for id, value in default_select.items():\n            ui.update_select(id=id, selected=value)\n        for id, value in default_checkbox.items():\n            ui.update_checkbox_group(id, selected=value)\n\n    # Workflow filter\n    @output\n    @render.data_frame\n    def filter():\n        filtered_wf = wf_tab.copy()\n        for q_name in questions:\n            filtered_wf = du.filter_replies(q_name, input[q_name](), filtered_wf)\n        return render.DataTable(filtered_wf)\n\n\n### ---------------------------- ###\n\napp = App(app_ui, server)\n", "type": "text"}, {"name": "data_utils.py", "content": "\"\"\"Utils function related to input data management\"\"\"\n\nimport pandas as pd\nfrom typing import Iterable, List, Union, Optional\nfrom shiny import ui\nfrom input_data import questions\n\n# Input functions\n\n\ndef input_question(id: str, label: str, choices: List[str], type: str):\n    \"\"\"Select ui group based on the question type\"\"\"\n    if type == \"select\":\n        return ui.input_select(id, label, choices)\n    elif type == \"checkbox\":\n        return ui.input_checkbox_group(id, label, choices)\n    else:\n        raise ValueError(f\"Unknown question type: {type}\")\n\n\n# Filter functions\n\n\ndef filter_replies(\n    q_name: str, answer: Optional[Union[str, Iterable]], workflows: pd.DataFrame\n) -> pd.DataFrame:\n    \"\"\"Apply specific filter functions for each question\"\"\"\n    match q_name:\n        case \"lang\":\n            return filter_lang(answer, workflows)\n        case \"k8\" | \"containers\" | \"combo\":\n            return filter_CEQ(q_name, answer, workflows)\n        # TODO: Maybe worth changing the name in workflowTable.tsv\n        case \"ml\":\n            return filter_CEQ(\"ML-compatible\", answer, workflows)\n        case \"format\":\n            return filter_format(answer, workflows)\n        case \"goal\":\n            return filter_goal(answer, workflows)\n        case _:\n            Warning(f\"No filter for {q_name} defined.\")\n            return workflows\n\n\ndef filter_CEQ(q_name: str, answer: str, workflows: pd.DataFrame) -> pd.DataFrame:\n    \"\"\"Workflow filter for closed-ended questions with only yes(yes-but) and no as possible answers\"\"\"\n    if answer == \"Not relevant\":\n        return workflows\n    elif answer == \"yes\":\n        return workflows[\n            (workflows[q_name] == \"yes\") | (workflows[q_name] == \"yes-but\")\n        ]\n    else:\n        return workflows[(workflows[q_name] == \"no\")]\n\n\ndef filter_lang(answer: str, workflows: pd.DataFrame) -> pd.DataFrame:\n    \"\"\"Workflow filter for language question\"\"\"\n    if answer == \"Not relevant\":\n        return workflows\n    elif answer == \"yes\":\n        return workflows[\n            (workflows[\"language\"] == \"Python\")\n            | (workflows[\"language\"] == \"Language-agnostic\")\n        ]\n    else:\n        return workflows[(workflows[\"language\"] != \"Python\")]\n\n\ndef filter_format(answer: Optional[Iterable], workflows: pd.DataFrame) -> pd.DataFrame:\n    \"\"\"Workflow filter based on selected formats\"\"\"\n    if not answer:\n        return workflows\n    else:\n        formats = [format for format in answer]\n    return workflows[(workflows[\"format\"].isin(formats))]\n\n\ndef filter_goal(answer: str, workflows: pd.DataFrame) -> pd.DataFrame:\n    \"\"\"Workflow filter based on teh overall goal\"\"\"\n    if answer == \"Not relevant\":\n        return workflows\n    elif answer == \"full automation\":\n        return workflows[(workflows[\"goal\"] == \"auto\")]\n    else:\n        return workflows[(workflows[\"goal\"] == \"pipeline\")]\n", "type": "text"}, {"name": "input_data.py", "content": "\"\"\" Definitions and specifications of all input data \"\"\"\n\n# Answers\nyn_choices = [\"Not relevant\", \"yes\", \"no\"]\nformat_choices = [\"Python\", \"YAML\", \"R\", \"Groovy\"]\ngoal_choices = [\"Not relevant\", \"full automation\", \"reproducibility only\"]\n\n\n# Questions\nquestions = {\n    \"lang\": {\n        \"label\": \"Is your workflow using only Python as language?\",\n        \"choices\": yn_choices,\n        \"type\": \"select\",\n    },\n    \"k8\": {\n        \"label\": \"Are you working or planning to work with Kubernetes?\",\n        \"choices\": yn_choices,\n        \"type\": \"select\",\n    },\n    \"ml\": {\n        \"label\": \"Are you using sklearn, tensorflow or other ML/AI libraries?\",\n        \"choices\": yn_choices,\n        \"type\": \"select\",\n    },\n    \"containers\": {\n        \"label\": \"Are you using or planning to use containers?\",\n        \"choices\": yn_choices,\n        \"type\": \"select\",\n    },\n    \"format\": {\n        \"label\": \"Which format and/or language are you comfortable with?\",\n        \"choices\": format_choices,\n        \"type\": \"checkbox\",\n    },\n    \"goal\": {\n        \"label\": \"Is your end goal full automation (reproducibility+scheduling) or reproducibility only?\",\n        \"choices\": goal_choices,\n        \"type\": \"select\",\n    },\n    \"combo\": {\n        \"label\": \"Would you like to combine workflow managers for different aspects of your workflow?\",\n        \"choices\": yn_choices,\n        \"type\": \"select\",\n    },\n}\n\n# Defaults\n\n## Defaults select\ndefault_select = {\n    \"lang\": \"Not relevant\",\n    \"k8\": \"Not relevant\",\n    \"ml\": \"Not relevant\",\n    \"containers\": \"Not relevant\",\n    \"goal\": \"Not relevant\",\n    \"combo\": \"Not relevant\",\n}\n\n## Defaults checkbox\ndefault_checkbox = {\"format\": []}\n", "type": "text"}, {"name": "workflowTable.tsv", "content": "name\tlanguage\tk8\tML-compatible\tcontainers\tformat\tgoal\tcombo\nAirFlow\tLanguage-agnostic\tyes\tyes\tyes\tPython\tauto\tyes\nArgo\tLanguage-agnostic\tyes\tyes\tyes\tYAML\tauto\tyes\nDVC\tPython\tno\tyes\tno\tYAML\tauto\tno\nDagster\tPython\tyes-but\tyes\tyes\tPython\tauto\tno\nDigdag\tLanguage-agnostic\tyes\tyes-but\tyes\tYAML\tauto\tno\nHamilton\tPython\tno\tyes\tno\tPython\tpipeline\tyes\nKedro\tPython\tyes\tyes-but\tyes\tPython\tpipeline\tyes\nLuigi\tPython\tyes\tyes-but\tyes\tPython\tpipeline\tyes\nMetaflow\tPython\tyes-but\tyes\tyes\tPython\tpipeline\tyes\nNextflow\tLanguage-agnostic\tyes-but\tyes\tyes\tGroovy\tpipeline\tyes\nPachyderm\tPython\tyes\tyes\tno\tYAML\tauto\tno\nPrefect\tPython\tyes-but\tno\tno\tPython\tauto\tno\nSnakemake \tLanguage-agnostic\tyes-but\tyes\tyes\tPython\tpipeline\tyes\nTargets \tR\tno\tno\tno\tR\tpipeline\tyes", "type": "text"}, {"name": "static/styles/main.css", "content": " /* main.css */\n\n /* unvisited link */\na:link {\n    color: black;\n}\n/* visited link */\na:visited {\n    color: black;\n}\n/* mouse over link */\na:hover {\n    color: hotpink;\n}\n/* selected link */\na:active {\n    color: black;\n}\n", "type": "text"}]